<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ü–∞—Ä–æ–ª–µ–π</title>
    <style>
        :root {
            --color-bg-primary: var(--color-cream-50, #fcfcf9);
            --color-surface: var(--color-cream-100, #fffdfd);
            --color-text-primary: var(--color-slate-900, #13343b);
            --color-primary: var(--color-teal-500, #21808d);
            --color-primary-hover: var(--color-teal-600, #1d7480);
            --color-error: var(--color-red-500, #c0152f);
        }
        html, body {
            font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
            background: var(--color-bg-primary);
            color: var(--color-text-primary);
        }
        .container {
            max-width: 440px;
            margin: 40px auto;
            background: var(--color-surface);
            border-radius: 10px;
            box-shadow: 0 4px 24px rgba(19,52,59,0.08);
            padding: 28px 24px;
        }
        h1 {
            font-size: 2rem;
            font-weight: 600;
            text-align: center;
            margin-bottom: 18px;
        }
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
        }
        .options {
            margin-bottom: 14px;
        }
        .options label {
            font-weight: 400;
            margin-right: 16px;
            cursor: pointer;
        }
        input[type="number"] {
            width: 64px;
            padding: 6px;
            font-size: 1rem;
            border-radius: 6px;
            border: 1px solid #ccc;
        }
        .btn {
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-size: 1rem;
            margin-top: 8px;
            cursor: pointer;
            transition: background .18s;
        }
        .btn:hover, .btn:active {
            background: var(--color-primary-hover);
        }
        .password-box {
            margin: 18px 0 10px 0;
            display: flex;
        }
        .password-output {
            font-family: 'Berkeley Mono', 'Courier New', monospace;
            font-size: 1.25rem;
            padding: 10px;
            flex: 1;
            background: #f3f3ef;
            border-radius: 7px;
            border: 1px solid #eee;
            word-break: break-all;
            min-height: 40px;
            display: flex;
            align-items: center;
        }
        .copy-btn {
            margin-left: 10px;
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: 7px;
            padding: 0 16px;
            font-size: 1.15rem;
            cursor: pointer;
            transition: background .18s;
            height: 40px;
        }
        .copy-btn:hover {
            background: var(--color-primary-hover);
        }
        .copy-btn:active {
            background: var(--color-primary-hover);
        }
        .strength-bar {
            height: 8px;
            border-radius: 4px;
            background: #eee;
            margin-bottom: 15px;
            position: relative;
        }
        .strength-fill {
            height: 100%;
            border-radius: 4px;
            background: var(--color-primary);
            transition: width .18s;
        }
        .strength-label {
            font-size: 0.96rem;
            font-weight: 500;
            margin-bottom: 9px;
            color: var(--color-primary);
            min-height: 1.2em;
        }
        .error {
            color: var(--color-error);
            margin-bottom: 11px;
            font-size: 0.97rem;
            min-height: 1.4em;
        }
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ü–∞—Ä–æ–ª–µ–π</h1>
    <form id="pw-form" autocomplete="off">
        <div class="options">
            <label>
                –î–ª–∏–Ω–∞ –ø–∞—Ä–æ–ª—è:
                <input type="number" id="length-ctrl" min="6" max="32" value="12" required>
            </label>
        </div>
        <div class="options">
            <label>
                <input type="checkbox" id="uppercase-ctrl" checked>
                –ø—Ä–æ–ø–∏—Å–Ω—ã–µ –±—É–∫–≤—ã (A-Z)
            </label>
            <label>
                <input type="checkbox" id="lowercase-ctrl" checked>
                —Å—Ç—Ä–æ—á–Ω—ã–µ –±—É–∫–≤—ã (a-z)
            </label>
            <label>
                <input type="checkbox" id="digits-ctrl" checked>
                —Ü–∏—Ñ—Ä—ã (0-9)
            </label>
            <label>
                <input type="checkbox" id="symbols-ctrl">
                —Å–∏–º–≤–æ–ª—ã (!@#$%&amp;*)
            </label>
        </div>
        <button type="submit" class="btn">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–æ–ª—å</button>
    </form>
    <div class="error" id="error-box"></div>
    <div class="password-box">
        <div class="password-output" id="pw-output"></div>
        <button type="button" class="copy-btn" id="copy-btn" title="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å">üìã</button>
    </div>
    <div class="strength-label" id="strength-label"></div>
    <div class="strength-bar">
        <div class="strength-fill" id="strength-fill" style="width:0%"></div>
    </div>
</div>

<script>
    const pwForm = document.getElementById('pw-form');
    const lengthCtrl = document.getElementById('length-ctrl');
    const upperCtrl = document.getElementById('uppercase-ctrl');
    const lowerCtrl = document.getElementById('lowercase-ctrl');
    const digitCtrl = document.getElementById('digits-ctrl');
    const symbolCtrl = document.getElementById('symbols-ctrl');
    const pwOutput = document.getElementById('pw-output');
    const errorBox = document.getElementById('error-box');
    const copyBtn = document.getElementById('copy-btn');
    const strengthLabel = document.getElementById('strength-label');
    const strengthFill = document.getElementById('strength-fill');

    function estimateStrength(password, sets) {
        let score = 0;
        if (sets.upper) score += 10;
        if (sets.lower) score += 10;
        if (sets.digit) score += 10;
        if (sets.symbol) score += 12;
        score += password.length * 2;
        if ([sets.upper, sets.lower, sets.digit, sets.symbol].filter(Boolean).length > 2)
            score += 10;
        if (score < 35) return { fill: 33, label: "–°–ª–∞–±—ã–π –ø–∞—Ä–æ–ª—å" };
        if (score < 54) return { fill: 60, label: "–°—Ä–µ–¥–Ω–∏–π –ø–∞—Ä–æ–ª—å" };
        if (score < 70) return { fill: 80, label: "–•–æ—Ä–æ—à–∏–π –ø–∞—Ä–æ–ª—å" };
        return { fill: 100, label: "–ù–∞–¥—ë–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å" };
    }

    function showOutput(password, sets) {
        pwOutput.textContent = password;
        let est = estimateStrength(password, sets);
        strengthFill.style.width = est.fill + '%';
        strengthLabel.textContent = password ? est.label : '';
    }

    async function fetchPassword(length, options) {
        try {
            pwForm.classList.add('loading');
            errorBox.textContent = '';
            
            const params = new URLSearchParams({
                length: length,
                uppercase: options.upper,
                lowercase: options.lower,
                digits: options.digit,
                symbols: options.symbol
            });

            const response = await fetch(`/api/password?${params}`);
            const data = await response.json();

            if (!response.ok) {
                errorBox.textContent = data.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–∞—Ä–æ–ª—è';
                return null;
            }

            return data;
        } catch (err) {
            errorBox.textContent = '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ' + err.message;
            return null;
        } finally {
            pwForm.classList.remove('loading');
        }
    }

    pwForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        errorBox.textContent = '';

        let len = parseInt(lengthCtrl.value, 10);
        if (isNaN(len) || len < 6 || len > 32) {
            errorBox.textContent = "–î–ª–∏–Ω–∞ –ø–∞—Ä–æ–ª—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 6 –¥–æ 32 —Å–∏–º–≤–æ–ª–æ–≤.";
            showOutput('', {upper:upperCtrl.checked, lower:lowerCtrl.checked, digit:digitCtrl.checked, symbol:symbolCtrl.checked});
            return;
        }

        let sets = {
            upper: upperCtrl.checked,
            lower: lowerCtrl.checked,
            digit: digitCtrl.checked,
            symbol: symbolCtrl.checked
        };

        if (!sets.upper && !sets.lower && !sets.digit && !sets.symbol) {
            errorBox.textContent = "–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –≥—Ä—É–ø–ø—É —Å–∏–º–≤–æ–ª–æ–≤.";
            showOutput('', sets);
            return;
        }

        const result = await fetchPassword(len, sets);
        if (result) {
            showOutput(result.password, sets);
        }
    });

    copyBtn.addEventListener('click', function() {
        let value = pwOutput.textContent;
        if (!value) return;
        navigator.clipboard.writeText(value);
        copyBtn.textContent = "‚úî";
        setTimeout(() => copyBtn.textContent = "üìã", 950);
    });

    pwOutput.textContent = '';
    showOutput('', {upper:true, lower:true, digit:true, symbol:false});
</script>
</body>
</html>
